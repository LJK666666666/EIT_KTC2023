# EITæ·±åº¦å­¦ä¹ é‡å»ºç³»ç»Ÿ - æœ€ç»ˆçŠ¶æ€æŠ¥å‘Š

## âœ… é—®é¢˜ä¿®å¤å®Œæˆ

### å…³é”®é—®é¢˜ï¼šæµ‹é‡ç»´åº¦ä¸åŒ¹é…

**é—®é¢˜æè¿°**ï¼š
- åŸå§‹ä»¿çœŸæ•°æ®ä½¿ç”¨ç®€å•çš„ç›¸é‚»æ³¨å…¥æ¨¡å¼ï¼š992ç»´ï¼ˆ32ç”µæ Ã— 31æµ‹é‡ï¼‰
- è¯„ä¼°æ•°æ®ä½¿ç”¨å¤æ‚çš„skip patternï¼š2356ç»´ï¼ˆ76ä¸ªæ³¨å…¥æ¨¡å¼ Ã— 31æµ‹é‡ï¼‰

**è§£å†³æ–¹æ¡ˆ**ï¼š
âœ… å·²å®ç° - ä»¿çœŸæ•°æ®ç°åœ¨ä½¿ç”¨ä¸è¯„ä¼°æ•°æ®å®Œå…¨ç›¸åŒçš„æµ‹é‡æ¨¡å¼

### ä¿®æ”¹çš„æ–‡ä»¶

#### 1. `src/sim_dataset.py`
- âœ… æ·»åŠ  `use_evaluation_pattern` å‚æ•°
- âœ… å®ç° `_load_evaluation_pattern()` æ–¹æ³•
- âœ… ä» `EvaluationData_full/evaluation_datasets/level1/ref.mat` åŠ è½½æµ‹é‡æ¨¡å¼
- âœ… ç”Ÿæˆçš„æµ‹é‡æ•°æ®ç°åœ¨æ˜¯2356ç»´

#### 2. `src/eval_dataset.py`
- âœ… æ›´æ–°æ–‡æ¡£è¯´æ˜ä½¿ç”¨å®Œæ•´ç”µææ•°æ®
- âœ… ç¡®è®¤ä» `EvaluationData_full/evaluation_datasets` åŠ è½½æ•°æ®
- âœ… Ground truthä» `EvaluationData/GroundTruths` åŠ è½½

#### 3. `src/generate_simdata.py`
- âœ… è®¾ç½® `use_evaluation_pattern=True`
- âœ… è¾“å‡ºæ˜¾ç¤ºæ–°çš„æµ‹é‡æ¨¡å¼ä¿¡æ¯

#### 4. `src/test_pipeline.py`
- âœ… æ›´æ–° `input_dim` ä»992åˆ°2356

## ğŸ“Š æµ‹é‡æ¨¡å¼è¯¦æƒ…

### è¯„ä¼°æ•°æ®æµ‹é‡æ¨¡å¼
```
æ³¨å…¥æ¨¡å¼ (Injref): (32, 76)
  - 76ä¸ªä¸åŒçš„ç”µæµæ³¨å…¥æ¨¡å¼
  - æ¯ä¸ªæ¨¡å¼åœ¨32ä¸ªç”µæä¸Šå®šä¹‰

æµ‹é‡æ¨¡å¼ (Mpat): (32, 31)
  - 31ä¸ªç”µå‹å·®åˆ†æµ‹é‡
  - ä½¿ç”¨ç›¸é‚»ç”µæå·®åˆ†

æ€»æµ‹é‡æ•°: 76 Ã— 31 = 2356
```

### ä»¿çœŸæ•°æ®ç°åœ¨åŒ¹é…
```python
dataset = SimulatedEITDataset(use_evaluation_pattern=True)
# è¾“å‡º:
# Loaded evaluation measurement pattern:
#   Injection patterns: 76
#   Measurements per injection: 31
#   Total measurements: 2356
```

## ğŸš€ å½“å‰çŠ¶æ€

### æ­£åœ¨è¿›è¡Œçš„ä»»åŠ¡
1. âœ… æµ‹é‡æ¨¡å¼å·²ä¿®å¤å¹¶éªŒè¯
2. ğŸ”„ æ­£åœ¨ç”Ÿæˆ200ä¸ªæ–°çš„æµ‹è¯•æ ·æœ¬ï¼ˆä½¿ç”¨æ­£ç¡®çš„æµ‹é‡æ¨¡å¼ï¼‰
3. â³ å¾…å®Œæˆï¼šä½¿ç”¨æ–°æ•°æ®è®­ç»ƒå’Œè¯„ä¼°

### æ•°æ®ç”Ÿæˆè¿›åº¦
```bash
# å‘½ä»¤ï¼š
python src/generate_simdata.py --num_samples 200

# çŠ¶æ€ï¼šåå°è¿è¡Œä¸­
# é¢„è®¡æ—¶é—´ï¼š~15åˆ†é’Ÿï¼ˆ200æ ·æœ¬ Ã— 4.5ç§’/æ ·æœ¬ï¼‰
```

## ğŸ“ æ•°æ®ç›®å½•ç»“æ„

```
EIT_KTC2023/
â”œâ”€â”€ EvaluationData_full/           # â† å®Œæ•´ç”µææµ‹é‡æ•°æ®
â”‚   â””â”€â”€ evaluation_datasets/
â”‚       â”œâ”€â”€ level1/                # Level 1æ•°æ®ï¼ˆæœ€ç®€å•ï¼‰
â”‚       â”‚   â”œâ”€â”€ ref.mat           # å‚è€ƒæµ‹é‡å’Œæµ‹é‡æ¨¡å¼
â”‚       â”‚   â”œâ”€â”€ data1.mat         # æµ‹è¯•æ•°æ®1
â”‚       â”‚   â”œâ”€â”€ data2.mat
â”‚       â”‚   â””â”€â”€ data3.mat
â”‚       â”œâ”€â”€ level2/                # æ›´éš¾çš„æ•°æ®
â”‚       â””â”€â”€ ...
â”‚
â”œâ”€â”€ EvaluationData/                # Ground Truth
â”‚   â””â”€â”€ GroundTruths/
â”‚       â”œâ”€â”€ level_1/
â”‚       â”‚   â”œâ”€â”€ 1_true.mat        # å¯¹åº”data1çš„GT
â”‚       â”‚   â”œâ”€â”€ 2_true.mat
â”‚       â”‚   â””â”€â”€ 3_true.mat
â”‚       â””â”€â”€ ...
â”‚
â””â”€â”€ SimData/                       # ä»¿çœŸè®­ç»ƒæ•°æ®
    â””â”€â”€ level_1/                   # â† ä½¿ç”¨å®Œæ•´ç”µææ¨¡å¼
        â”œâ”€â”€ gt/
        â”‚   â”œâ”€â”€ gt_00000.npy      # 256Ã—256 åˆ†å‰²å›¾
        â”‚   â””â”€â”€ ...
        â””â”€â”€ measurements/
            â”œâ”€â”€ u_00000.npy       # 2356ç»´æµ‹é‡ï¼ˆæ­£ç¡®ï¼ï¼‰
            â””â”€â”€ ...
```

## ğŸ¯ å®Œæ•´å·¥ä½œæµç¨‹

### 1. æ•°æ®ç”Ÿæˆï¼ˆä½¿ç”¨æ­£ç¡®çš„æµ‹é‡æ¨¡å¼ï¼‰
```bash
# å¿«é€Ÿæµ‹è¯•ï¼ˆ200æ ·æœ¬ï¼‰
python src/generate_simdata.py --num_samples 200

# å®Œæ•´æ•°æ®é›†ï¼ˆ10000æ ·æœ¬ï¼Œéœ€è¦~12å°æ—¶ï¼‰
python src/generate_simdata.py --num_samples 10000
```

### 2. è®­ç»ƒæ¨¡å‹
```bash
python src/train.py
```

æˆ–åœ¨Pythonä¸­ï¼š
```python
from src.train import train_model

config = {
    'exp_name': 'eit_reconstruction_v2',
    'model_name': 'simple',
    'input_dim': 2356,  # æ­£ç¡®çš„ç»´åº¦
    'data_path': 'SimData/level_1',
    'num_samples': 200,
    'batch_size': 16,
    'epochs': 50,
    'learning_rate': 1e-3,
}

model, history, save_dir = train_model(config)
```

### 3. è¯„ä¼°æ¨¡å‹
```bash
python src/evaluate.py --model_path results/xxx/best_model.pth
```

ç°åœ¨æ‰€æœ‰ç»´åº¦éƒ½åŒ¹é…äº†ï¼

### 4. æµ‹è¯•å®Œæ•´æµç¨‹
```bash
python src/test_pipeline.py
```

## ğŸ”¬ éªŒè¯æµ‹è¯•

### æµ‹è¯•1ï¼šæ•°æ®é›†ç»´åº¦éªŒè¯
```python
from src.sim_dataset import SimulatedEITDataset

dataset = SimulatedEITDataset(length=2, use_evaluation_pattern=True)
phantom, measurements = dataset[0]

assert measurements.shape[0] == 2356, "æµ‹é‡ç»´åº¦åº”ä¸º2356"
# âœ“ é€šè¿‡
```

### æµ‹è¯•2ï¼šè¯„ä¼°æ•°æ®åŠ è½½éªŒè¯
```python
from src.eval_dataset import EvaluationDataset

dataset = EvaluationDataset(level=1)
measurements, gt, idx = dataset[0]

assert measurements.shape[0] == 2356, "æµ‹é‡ç»´åº¦åº”ä¸º2356"
# âœ“ é€šè¿‡
```

### æµ‹è¯•3ï¼šæ¨¡å‹è¾“å…¥éªŒè¯
```python
from src.model import EITReconstructionNet
import torch

model = EITReconstructionNet(input_dim=2356)
x = torch.randn(1, 2356)
output = model(x)

assert output.shape == (1, 3, 256, 256), "è¾“å‡ºåº”ä¸º[1, 3, 256, 256]"
# âœ“ é€šè¿‡
```

## ğŸ“ˆ é¢„æœŸæ€§èƒ½

ä½¿ç”¨æ­£ç¡®çš„æµ‹é‡æ¨¡å¼åï¼Œé¢„æœŸæ€§èƒ½ï¼š

### è®­ç»ƒ
- æ•°æ®ç»´åº¦ï¼š2356ç»´ï¼ˆæ¯”992ç»´æ›´ä¸°å¯Œï¼‰
- æ¨¡å‹å‚æ•°ï¼š~91Mï¼ˆè¾“å…¥å±‚æ›´å¤§ï¼‰
- è®­ç»ƒæ—¶é—´ï¼šç±»ä¼¼ï¼ˆ~2-3ç§’/batchï¼‰

### è¯„ä¼°
- **å…³é”®ä¼˜åŠ¿**ï¼šè®­ç»ƒæ•°æ®å’Œè¯„ä¼°æ•°æ®ä½¿ç”¨ç›¸åŒçš„æµ‹é‡æ¨¡å¼
- é¢„æœŸKTCè¯„åˆ†æå‡ï¼š0.6-0.8ï¼ˆä¹‹å‰ç”±äºç»´åº¦ä¸åŒ¹é…æ— æ³•è¯„ä¼°ï¼‰

## ğŸ“ é‡è¦è¯´æ˜

### âœ… æ­£ç¡®ç†è§£
- `EvaluationData_full` = æ‰€æœ‰levelçš„æ•°æ®éƒ½ä½¿ç”¨å®Œæ•´32ä¸ªç”µææµ‹é‡
- Level 1-7 è¡¨ç¤ºæ•°æ®çš„**éš¾åº¦çº§åˆ«**ï¼Œä¸æ˜¯ç”µæç§»é™¤
- æµ‹é‡æ¨¡å¼ï¼ˆ76ä¸ªæ³¨å…¥ï¼‰å¯¹æ‰€æœ‰leveléƒ½ç›¸åŒ

### âŒ ä¹‹å‰çš„è¯¯è§£
- ~~Levelè¡¨ç¤ºç§»é™¤ç”µææ•°é‡~~ ï¼ˆé”™è¯¯ï¼‰
- ~~éœ€è¦é€‚é…ä¸åŒçš„ç”µæé…ç½®~~ ï¼ˆä¸éœ€è¦ï¼‰

## ğŸ‰ é¡¹ç›®å®Œæˆåº¦

### æ ¸å¿ƒåŠŸèƒ½
- âœ… ä»¿çœŸæ•°æ®ç”Ÿæˆï¼ˆä½¿ç”¨æ­£ç¡®æµ‹é‡æ¨¡å¼ï¼‰
- âœ… ç¥ç»ç½‘ç»œæ¨¡å‹
- âœ… è®­ç»ƒç³»ç»Ÿ
- âœ… è¯„ä¼°ç³»ç»Ÿ
- âœ… å¯è§†åŒ–å’Œè¯„åˆ†

### æ•°æ®å…¼å®¹æ€§
- âœ… ä»¿çœŸæ•°æ® â†”ï¸ è¯„ä¼°æ•°æ®ï¼ˆç»´åº¦åŒ¹é…ï¼‰
- âœ… è®­ç»ƒé›† â†”ï¸ æµ‹è¯•é›†ï¼ˆç›¸åŒæµ‹é‡æ¨¡å¼ï¼‰
- âœ… æ¨¡å‹è¾“å…¥ â†”ï¸ æ•°æ®è¾“å‡ºï¼ˆå®Œå…¨å…¼å®¹ï¼‰

### å¾…å®Œæˆ
- â³ ç”Ÿæˆè¶³å¤Ÿçš„è®­ç»ƒæ•°æ®ï¼ˆ200ä¸ªæ­£åœ¨ç”Ÿæˆï¼Œå»ºè®®10000ä¸ªï¼‰
- â³ å®Œæ•´è®­ç»ƒï¼ˆ50-100 epochsï¼‰
- â³ åœ¨æ‰€æœ‰7ä¸ªlevelä¸Šè¯„ä¼°

## ğŸ“ ä¸‹ä¸€æ­¥æ“ä½œ

1. **ç­‰å¾…æ•°æ®ç”Ÿæˆå®Œæˆ**ï¼ˆ15åˆ†é’Ÿï¼‰
   ```bash
   # ç›‘æ§è¿›åº¦
   watch -n 10 'ls SimData/level_1/gt/*.npy | wc -l'
   ```

2. **è¿è¡Œå®Œæ•´æµ‹è¯•**
   ```bash
   python src/test_pipeline.py
   ```

3. **æŸ¥çœ‹ç»“æœ**
   ```bash
   # è®­ç»ƒæ›²çº¿
   cat results/test_eit_reconstruction_*/training_curves.png

   # è¯„ä¼°å¯¹æ¯”å›¾
   cat results/test_eit_reconstruction_*/evaluation/level1/data1_comparison.png

   # è¯„åˆ†æŠ¥å‘Š
   cat results/test_eit_reconstruction_*/evaluation/summary_report.txt
   ```

## âœ¨ æ€»ç»“

**æ‰€æœ‰ç»´åº¦åŒ¹é…é—®é¢˜å·²è§£å†³ï¼**

ç°åœ¨ç³»ç»Ÿå®Œå…¨å¯ç”¨ï¼š
- ä»¿çœŸæ•°æ®ä½¿ç”¨è¯„ä¼°æ•°æ®çš„æµ‹é‡æ¨¡å¼ âœ…
- æ¨¡å‹è¾“å…¥ç»´åº¦æ­£ç¡®ï¼ˆ2356ï¼‰ âœ…
- è¯„ä¼°æ•°æ®æ­£ç¡®åŠ è½½ âœ…
- è®­ç»ƒ-è¯„ä¼°æµç¨‹æ‰“é€š âœ…

å‡†å¤‡å°±ç»ªï¼Œå¯ä»¥å¼€å§‹å®Œæ•´çš„è®­ç»ƒå’Œè¯„ä¼°ï¼ğŸš€

---

**æœ€åæ›´æ–°**: 2025-10-28
**çŠ¶æ€**: âœ… ç»´åº¦é—®é¢˜å·²ä¿®å¤ï¼Œæ•°æ®ç”Ÿæˆä¸­
**é¢„è®¡å®Œæˆ**: 15åˆ†é’Ÿåå¯è¿›è¡Œå®Œæ•´æµ‹è¯•
